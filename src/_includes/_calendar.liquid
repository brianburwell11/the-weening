{% comment %}
  Reusable Calendar Template
  Usage: {% include '_calendar.liquid', year: 2025, monthStartsOnWeekday: 3, dataSet: weening2025, customCss: 'halloween2024.css' %}

  Parameters:
  - year: The year for the calendar (e.g., 2025)
  - monthStartsOnWeekday: Day of week the month starts (0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, etc.)
  - dataSet: The data collection to use for movie information (e.g., weening2025, weening2026, etc.)
  - customCss: Optional CSS file to load for custom styling (e.g., 'halloween2024.css', 'christmas2025.css')
{% endcomment %}

{% comment %} Set default values if not provided {% endcomment %}
{% unless year %}{% assign year = 2025 %}{% endunless %}
{% unless monthStartsOnWeekday %}{% assign monthStartsOnWeekday = 3 %}{% endunless %}
{% unless dataSet %}{% assign dataSet = weening2025 %}{% endunless %}

{% comment %} Load custom CSS if provided {% endcomment %}
{% if customCss %}
  <link rel="stylesheet" href="/assets/css/{{ customCss }}">
{% endif %}

{% comment %} Get today's date for highlighting {% endcomment %}
{% comment %} {% assign today = 'now' | date: '%Y-%m-%d' %} {% endcomment %}
{% assign today = '2025-10-16' %}
{% assign today_year = '2025' %}
{% assign today_month = '10' %}
{% assign today_day = '16' %}
<!-- Debug: today={{ today }}, today_year={{ today_year }}, today_month={{ today_month }}, today_day={{ today_day }} -->

<section class="calendar-section">
  <div class="calendar-container">
    <div class="calendar-title">
      <h1>The 'Weening {{ year }}</h1>
      {% if subtitle %}
        <h2 class="calendar-subtitle">{{ subtitle }}</h2>
      {% endif %}
    </div>

    <div class="calendar-wrapper">
      <div class="calendar-grid" id="calendar-grid">
        <!-- Header Row -->
        <div class="calendar-header-cell">Sunday</div>
        <div class="calendar-header-cell">Monday</div>
        <div class="calendar-header-cell">Tuesday</div>
        <div class="calendar-header-cell">Wednesday</div>
        <div class="calendar-header-cell">Thursday</div>
        <div class="calendar-header-cell">Friday</div>
        <div class="calendar-header-cell">Saturday</div>

        <!-- Empty cells for days before the month starts -->
        {% assign blankCells = monthStartsOnWeekday | minus: 1 %}
        {% for i in (0..blankCells) %}
          <div class="calendar-cell empty"></div>
        {% endfor %}

        <!-- Calendar Days -->
        {% for day in (1..31) %}
          {% assign day_str = year | append: '-10-' | append: day %}
          {% if day < 10 %}
            {% assign day_str = year | append: '-10-0' | append: day %}
          {% endif %}
          {% assign day_movies = dataSet | where: 'date', day_str %}

          {% assign is_today = false %}
          {% assign year_string = year | append: '' %}
          {% assign day_string = day | append: '' %}
          {% if year_string == today_year and today_month == '10' and day_string == today_day %}
            {% assign is_today = true %}
          {% endif %}
          <!--
            Debug: year={{ year }}, today_year={{ today_year }}, today_month={{ today_month }}, day={{ day }}, day_string={{ day_string }}, today_day={{ today_day }}, is_today={{ is_today }}
          -->
          {% assign is_halloween = false %}
          {% if day == 31 %}
            {% assign is_halloween = true %}
          {% endif %}
          <div class="calendar-cell{% if day_movies.size == 0 %} empty{% endif %}{% if is_today %} today{% endif %}{% if is_halloween %} halloween{% endif %}">
            <div class="date">{{ day }}</div>
            {% if day_movies.size > 0 %}
              <div class="event-buttons">
                {% for movie in day_movies %}
                  <a
                    href="/movies/{{ movie.tmdb | slugify }}/"
                    class="{% if movie.type == 'Ween' %}ween-btn{% else %}weenie-btn{% endif %} movie-card{% if movie['release-year'] == year_string %} new-release{% endif %}"
                    data-modal-url="/movies/{{ movie.tmdb | slugify }}/"
                  >
                    {{ movie.title }}
                  </a>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
